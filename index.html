<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vennly</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400..800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <style>
        body{
            background-color: #1e1e1e;
            margin: 0;
            overflow: hidden;
            height: 844px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: "Baloo 2", sans-serif;
            font-size: 25px;
            position: relative;
        }
        .grid{
            display: grid;
            grid-template-rows: repeat(3, 1fr);
            grid-template-columns: repeat(3, 1fr);
            height: 305px;
            width: 305px;
            gap: 10px;
        }
        .container{
            width: 390px;
            height: 844px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .swiper{
            height: 100%;
            width: 100%;
        }
        .app-page{
            height: 100%;
            width: 100%;
            background-color: #FFF9CA;
            display: flex;
            align-items: center;
            flex-direction: column;
        }
        .number{
            border-radius: 23px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        .number h1{
            margin: 0px;
        }
        .number.locked{
            cursor: not-allowed;
            color: #737373 !important ;
            background-color: #b6b6b6 !important ;
        }
        
        .page1 .number{
            background-color: #FFD9E1;
            color: #FFA8C8;
        }
        .page2 .number{
            background-color: #C0E3FF;
            color: #5FA3FF;
        }
        .page3 .number{
            background-color: #F0D5FF;
            color: #C886F8;
        }
        .venn-container {
            position: absolute; 
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 20; 
            display: none;
            background-color: white;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
            background-color: #FFF9CA;
        }
        .rect-clickable, path{
            stroke-width: 1;
            fill: white;
            stroke: black;
        }
        .clicked {
            fill: #F0FFBD !important;
        }
        svg text{
            font-size: 7px;
            font-weight: bold;
            fill: black;
            text-anchor: middle;
            pointer-events: none;
        }
        svg text.universe{
            font-size: 10px;
        }
        #submit-btn{
            height: 69px;
            width: 133px;
            font-size: 24px;
            font-weight: 900;   
            border: none;
            border-radius: 23px;
            background-color: #FF7A69;
            color: white;
            cursor: pointer;
        }
        #submit-btn:active, #back-btn:active ,.number:active,.question-logo:active{
            transform: scale(0.95);
        }
        .question-info{
            width: 302px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .question-info-row{
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            width: 100%;
        }
        .question-info-row #question-number,.question-info-row #status{
            width: 133px;
            height: 69px;
            margin: 0;
            font-size: 25px;
            font-weight: bold;
            border-radius: 23px;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .question-info-row #question-number{
            background-color: #FFC0A5;
        }
        .question-info-row #status{
            background-color: #AEB4FF;
        }
        #question{
            max-width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 20px;
            background-color: #FFD481;
            width: 100%;
            height: 69px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 23px;
            color: white;
            font-weight: bold;
            margin-top: 42px;
            margin-bottom: 0;
        }
        .swiper-pagination {
            position: absolute;
            bottom: 20px;
        }
        .swiper-pagination-bullet{
            background-color: #FFFFFF;
            opacity: 0.5;
        }
        .swiper-pagination-bullet-active{
            background-color: #FFAD7A;
            opacity: 1;
        }
        nav{
            background-color: #FFDEBD;
            height: 75px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        nav img{
            height: 38.64px;
            margin: 21px;
            cursor: pointer;
            vertical-align: middle;
        }
        .content-text{
            width: 305px;
            display: flex;
            flex-direction: row;
            color: white;
            font-weight: bold;
            align-items: center;
            margin: 50px;
            justify-content: space-between;
        }
        .content-text .stage{
            background-color: #FFC0A5;
            border-radius: 23px;
            padding: 20px 33px;
            font-size: 25px;
            height: 29px;
            width: 67px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .content-text .level{
            border-radius: 23px;
            font-size: 40px;
            width: 164px;
            height: 90px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .page1 .level{
            background-color: #FFD9E1;
            text-shadow: -1px -1px 0 #FFA8C8,1px -1px 0 #FFA8C8,-1px 1px 0 #FFA8C8,1px 1px 0 #FFA8C8;
        }
        .page2 .level{
            background-color: #C0E3FF;
            text-shadow: -1px -1px 0 #5FA3FF,1px -1px 0 #5FA3FF,-1px 1px 0 #5FA3FF,1px 1px 0 #5FA3FF;
        }
        .page3 .level{
            background-color: #F0D5FF;
            text-shadow: -1px -1px 0 #C886F8,1px -1px 0 #C886F8,-1px 1px 0 #C886F8,1px 1px 0 #C886F8;
        }
        .gridLogo{
            display: flex;
            justify-content: center;
        }
        .gridLogo img{
            height: 138px;
            margin-top: 32px;
        }
        footer{
            background-color: #FFDEBD;
            height: 75px;
            display: flex;
            align-items: center;
            width: 100%;
            position: relative;
        }
        footer img{
            height: 38.64px;
            margin: 21px;
            cursor: pointer;
        }
        footer .div-text-level{
            margin: 0;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            p{
                font-weight: bold;
                font-size: 35px;
            }
        }
        
        @keyframes shakeText {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .shake {
            animation: shakeText 0.5s;
        }

    </style>
</head>
<body>
    <div class="container">
        <nav>
            <img src="burger-tap.png" alt="" onclick="wtf()">
            <a href="https://www.wikipedia.org/"><img src="question-logo.png" alt="" class="question-logo"></a>
        </nav>
        <div class="swiper mySwiper" id="menu-container">
            <div class="swiper-wrapper">
                <div class="swiper-slide">
                    <div class="app-page page1">
                        <div class="content-text">
                            <div class="stage">Stage</div>
                            <div class="level">Newbie</div>
                        </div>
                        <div class="grid">
                            <div class="number " onclick="trytogoQuestion(1)"><h1>1</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(2)"><h1>2</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(3)"><h1>3</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(4)"><h1>4</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(5)"><h1>5</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(6)"><h1>6</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(7)"><h1>7</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(8)"><h1>8</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(9)"><h1>9</h1></div>
                        </div>
                        <div class="gridLogo">
                            <img src="logo.png" alt="">
                        </div>
                    </div>
                </div>
                <div class="swiper-slide">
                    <div class="app-page page2">
                        <div class="content-text">
                            <div class="stage">Stage</div>
                            <div class="level">Practice</div>
                        </div>
                        <div class="grid">
                            <div class="number locked" onclick="trytogoQuestion(10)"><h1>1</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(11)"><h1>2</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(12)"><h1>3</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(13)"><h1>4</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(14)"><h1>5</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(15)"><h1>6</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(16)"><h1>7</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(17)"><h1>8</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(18)"><h1>9</h1></div>
                        </div>
                        <div class="gridLogo">
                            <img src="logo.png" alt="">
                        </div>
                    </div>
                </div>
                <div class="swiper-slide">
                    <div class="app-page page3">
                        <div class="content-text">
                            <div class="stage">Stage</div>
                            <div class="level">Expert</div>
                        </div>
                        <div class="grid">
                            <div class="number locked" onclick="trytogoQuestion(19)"><h1>1</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(20)"><h1>2</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(21)"><h1>3</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(22)"><h1>4</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(23)"><h1>5</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(24)"><h1>6</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(25)"><h1>7</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(26)"><h1>8</h1></div>
                            <div class="number locked" onclick="trytogoQuestion(27)"><h1>9</h1></div>
                        </div>
                        <div class="gridLogo">
                            <img src="logo.png" alt="">
                        </div>
                    </div>
                </div>
            </div>
            <div class="swiper-pagination"></div>
        </div>
        <footer>
            <img src="go-back.png" alt="" onclick="wtf()">
        </footer>
        <div class="venn-container" id="quiz-container">
            <nav>
                <img src="burger-tap.png" alt="" onclick="wtf()">
                <a href="https://www.wikipedia.org/"><img src="question-logo.png" alt="" class="question-logo"></a>
            </nav>

            <div class="question-info">
                <div class="question-info-row">
                    <p id="question-number">Stage ...</p>
                    <p id="status">3 Sets</p>
                </div>
                <p id="question">Question ...</p>
            </div>

            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="280px" width="80%" viewBox="0 0 120 120">
                <rect class="rect-clickable" x="0" y="0" width="120" height="120" onclick="toggleColor(this, 128)" />
                <path d="M 60 20 A 30 30 0 1 0 31 71 30 30 0 0 1 51 48 30 30 0 0 1 60 20" onclick="toggleColor(this, 1)" />
                <path d="M 60 20 A 30 30 0 0 0 51 48 30 30 0 0 1 69 48 30 30 0 0 0 60 20" onclick="toggleColor(this, 2)" />
                <path d="M 60 20 A 30 30 0 1 1 89 71 30 30 0 0 0 69 48 30 30 0 0 0 60 20" onclick="toggleColor(this, 4)" />
                <path d="M 60 64 A 30 30 0 0 1 31 71 30 30 0 0 1 51 48 30 30 0 0 0 60 64" onclick="toggleColor(this, 8)" />
                <path d="M 60 64 A 30 30 0 0 1 51 48 30 30 0 0 1 69 48 30 30 0 0 1 60 64" onclick="toggleColor(this, 16)" />
                <path d="M 60 64 A 30 30 0 0 0 89 71 30 30 0 0 0 69 48 30 30 0 0 1 60 64" onclick="toggleColor(this, 32)" />
                <path d="M 31 71 A 30 30 0 1 0 89 71 30 30 0 0 1 60 64 30 30 0 0 1 31 71" onclick="toggleColor(this, 64)" />
                
                <text class="universe" x="112" y="10">U</text>
                <text x="18" y="18">A</text>
                <text x="102" y="18">B</text>
                <text x="60" y="115">C</text>
            </svg>

            <button id="submit-btn" onclick="submitAnswer()">Submit</button>
            <footer>
                <img src="go-back.png" alt="" id="back-btn" onclick="goBack()">
                <div class="div-text-level"><p id="text-level">loading level...</p></div>
            </footer>
        </div>
    </div>
</body>
<script>
    
    var swiper = new Swiper(".mySwiper",{
        slidePerView: 1,
        spaceBetween: 0,
        pagination: {
            el: ".swiper-pagination",
            clickable: true,
        },
        effect: 'slide',
        speed: 500,

    });

    const menuContainer = document.getElementById("menu-container");
    const quizContainer = document.getElementById("quiz-container");

    let selectedState = 0;
    let completedQuestions = {};
    let highestUnlockedQuestion = 1;
    let questions = [];

    async function loadQuestions(){
        try{
            let response = await fetch("questions.json");
            questions = await response.json();
            console.log("Questions loaded successfully: ",questions)
        }
        catch(error){
            console.error("Error loading questions: ",error)
            console.log("Using mock questions:", questions);
        }
        loadProgress();
        updateButtonStatus();
    }

    function trytogoQuestion(questionNumber){
        if(questionNumber>highestUnlockedQuestion){
            alert("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô");
            return;
        }
        gotoQuestion(questionNumber);
    }

    function gotoQuestion(questionNumber){
        if(!questions || questions.length===0){
            alert("‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            return;
        }
        
        currentIndex = questionNumber-1;

        if(currentIndex < 0 || currentIndex>questions.length){
            alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ");
            return;
        }

        menuContainer.style.display = "none";
        quizContainer.style.display = "flex";

        resetColor();
        showQuestions();
    }

    function goBack(){
        menuContainer.style.display = "block";
        quizContainer.style.display = "none";

        updateButtonStatus();
    }

    function showQuestions(){
        if(currentIndex>=questions.length){
            document.getElementById('question').innerText="‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß";
            alert("‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß")
            return;
        }

        let currentQuestion = questions[currentIndex]
        if(((currentIndex+1)%9)=== 0){
            document.getElementById("question-number").innerText = `Stage ${((currentIndex )%9)+1}`;
        }
        else{
            document.getElementById("question-number").innerText = `Stage ${((currentIndex + 1)%9)}`;
        }
        if((currentIndex+1)<=9 && (currentIndex+1)>0){
            document.getElementById('text-level').innerText = "Newbie"
        }
        else if((currentIndex+1)<=18 && (currentIndex+1)>9){
            document.getElementById('text-level').innerText = "Practice"
        }
        else if((currentIndex+1)<=27 && (currentIndex+1)>18){
            document.getElementById('text-level').innerText = "Expert"
        }
        document.getElementById('question').innerText = `${currentQuestion.text}`;
        
        document.getElementById('status').innerText = "3 Sets"
        if(completedQuestions[currentIndex]){
            selectedState =completedQuestions[currentIndex];
            lockSelectedArea();
        }
        else{
            resetColor();
        }
    }
    function resetColor(){
        document.querySelectorAll("path , .rect-clickable").forEach(el =>{
            el.classList.remove("clicked");
        });
        selectedState = 0;
    }
    function lockSelectedArea(){
        const elements = document.querySelectorAll("path , .rect-clickable");
        const values = [ 128 , 1 , 2 , 4 , 8 , 16 , 32 , 64 ];

        elements.forEach(el =>{
            el.classList.remove("clicked");
        });
        elements.forEach((el, index) =>{
            if(index<values.length && (selectedState & values[index])){
                el.classList.add("clicked");
            }
        })

    }

    function toggleColor(element, value) {
        if(element.classList.contains("clicked")){
            element.classList.remove("clicked");
            selectedState &= ~value;
        }
        else{
            element.classList.add("clicked");
            selectedState |= value
        }
    }

    function submitAnswer(){
        if(currentIndex>=questions.length) return;
        let correctAnswer = questions[currentIndex].answer.reduce((acc,val)=> acc | val,0);
        if (selectedState === correctAnswer){
            document.getElementById('status').innerText="‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";

            completedQuestions[currentIndex] = selectedState;

            if(currentIndex+1 === highestUnlockedQuestion){
                highestUnlockedQuestion++;
            }

            saveProgress();

            setTimeout(()=>{
                if(currentIndex+1 < questions.length && currentIndex+1 < highestUnlockedQuestion){
                    currentIndex++;
                    showQuestions();
                }
                else{
                    if(currentIndex+1 >= questions.length){
                        alert("‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß");
                        goBack();
                        swiper.slideTo(2);
                    }
                    else{
                        alert("error");
                    }
                }
            },1000)
        }
        else{
            document.getElementById('status').innerText='‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á'
            document.getElementById('status').classList.remove('shake');
            void document.getElementById('status').offsetWidth;
            document.getElementById('status').classList.add('shake');
        }

    }

    function updateButtonStatus(){
        for(let i = 1 ; i <= 27 ; i++){
            const questionIndex = i - 1;
            const pageIndex = Math.floor(questionIndex / 9);
            const buttonIndex = questionIndex % 9;

            const page = document.querySelector(`.page${pageIndex+1}`);
            if(!page) continue;

            const buttons = page.querySelectorAll('.number');
            if(buttonIndex >= buttons.length) continue;

            const button = buttons[buttonIndex];

            button.classList.remove('locked','completed');

            if(completedQuestions[questionIndex]){
                button.classList.add('completed');
            }
            else if(i > highestUnlockedQuestion){
                button.classList.add('locked');
            }
        }
    }

    function saveProgress(){
        localStorage.setItem('vennQuizCompleted',JSON.stringify(completedQuestions));
        localStorage.setItem('vennQuizHighestUnlocked', highestUnlockedQuestion);
    }

    function loadProgress(){
        try{
            const savedCompleted = localStorage.getItem('vennQuizCompleted')
            const savedHighest = localStorage.getItem('vennQuizHighestUnlocked')

            if (savedCompleted){
                completedQuestions = JSON.parse(savedCompleted);
            }
            if (savedHighest) {
                highestUnlockedQuestion = parseInt(savedHighest);
            }
        }
        catch (e){
            console.error('Error loading saved progress:', e);
        }
    }

    function wtf(){
        alert('‡∏Å‡∏î‡∏ó‡∏≥‡πÑ‡∏° ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏àüò°üò°üò°')
    }

window.onload = function(){
    loadQuestions();
}
</script>
</html>
